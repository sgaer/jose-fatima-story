<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jose & Fatima: Illustrated Storybook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        h1, h2, .serif {
            font-family: 'Playfair Display', serif;
        }
        .book-card {
            background: #fff;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            min-height: 650px;
            border-radius: 0.5rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .image-placeholder {
            background: linear-gradient(135deg, #e5e7eb 25%, #f3f4f6 100%);
            aspect-ratio: 16/9;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #004c4c;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .btn-nav {
            background-color: #004c4c;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-nav:disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
        }
        .tab-btn {
            padding: 1rem;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .tab-btn.active {
            color: #004c4c;
            border-bottom-color: #004c4c;
        }

        /* Printing Styles */
        @media print {
            body * { visibility: hidden; }
            #print-assignment, #print-assignment * { visibility: visible; }
            #print-assignment {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white !important;
                padding: 40px;
            }
            .no-print { display: none !important; }
        }

        #print-assignment {
            background: white;
            border: 2px solid #004c4c;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <div class="max-w-4xl w-full mt-8">
        <!-- Header -->
        <div class="text-center mb-6 no-print">
            <h1 class="text-4xl font-bold text-[#004c4c]">Jose & Fatima</h1>
            <nav class="flex justify-center gap-4 mt-4">
                <button onclick="setView('story')" id="tab-story" class="tab-btn active">The Story</button>
                <button onclick="setView('vocab')" id="tab-vocab" class="tab-btn">Practice & Print</button>
            </nav>
        </div>

        <!-- Story View -->
        <div id="story-view" class="book-card relative no-print">
            <div class="h-1 bg-gray-100 w-full">
                <div id="progress-bar" class="h-full bg-orange-400 transition-all duration-300" style="width: 20%"></div>
            </div>

            <div id="page-content" class="flex-grow flex flex-col">
                <div id="image-area" class="image-placeholder overflow-hidden">
                    <div id="loader" class="hidden flex flex-col items-center">
                        <div class="loading-spinner mb-2"></div>
                        <p class="text-sm text-gray-500">Painting the scene...</p>
                    </div>
                    <img id="story-image" class="w-full h-full object-cover hidden" alt="Story Illustration">
                </div>

                <div class="p-8 md:p-12 flex-grow flex flex-col justify-center">
                    <p id="story-text" class="text-xl md:text-2xl leading-relaxed text-gray-800 serif italic text-center"></p>
                </div>
            </div>

            <div class="p-6 bg-gray-50 border-t flex flex-wrap items-center justify-between gap-4">
                <div class="flex gap-2">
                    <button id="prev-btn" onclick="changePage(-1)" class="btn-nav">← Previous</button>
                    <button id="next-btn" onclick="changePage(1)" class="btn-nav">Next →</button>
                </div>
                <div class="flex items-center gap-4">
                    <button id="speak-btn" onclick="readAloud()" class="p-3 rounded-full bg-orange-100 text-orange-700 hover:bg-orange-200 transition-colors">
                        <svg id="speaker-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                        </svg>
                    </button>
                    <span id="page-number" class="text-gray-500 font-medium">Page 1 of 5</span>
                </div>
            </div>
        </div>

        <!-- Vocabulary & Print View -->
        <div id="vocab-view" class="book-card hidden p-8 overflow-y-auto max-h-[85vh] relative no-print">
            <h2 class="text-2xl font-bold text-[#004c4c] mb-6">Master These Words</h2>
            <div id="vocab-list" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-10"></div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Quiz -->
                <div class="bg-orange-50 p-6 rounded-xl border border-orange-200 h-fit">
                    <h3 class="text-xl font-bold text-orange-800 mb-4 flex items-center gap-2">Match the Meaning</h3>
                    <div id="quiz-container" class="space-y-4">
                        <p id="quiz-definition" class="text-lg text-center font-medium italic mb-4 min-h-[60px] flex items-center justify-center text-orange-900"></p>
                        <div id="quiz-options" class="grid grid-cols-2 gap-2"></div>
                    </div>
                </div>

                <!-- Assignment Writing -->
                <div class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                    <h3 class="text-xl font-bold text-blue-800 mb-4">Final Assignment</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-blue-700 uppercase mb-1">Student Full Name</label>
                            <input type="text" id="student-name" class="w-full p-2 rounded-lg border border-blue-200 focus:ring-2 focus:ring-blue-400 outline-none" placeholder="Enter your name">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-blue-700 mb-1">Select Vocabulary Word:</label>
                            <select id="writing-word-select" class="w-full p-2 rounded-lg border border-blue-300 bg-white"></select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-blue-700 mb-1">Write your sentence:</label>
                            <textarea id="student-sentence" rows="4" class="w-full p-3 rounded-lg border border-blue-300 focus:ring-2 focus:ring-blue-400 bg-white" placeholder="Write a sentence about the story..."></textarea>
                        </div>
                        <button onclick="generatePrintDoc()" class="w-full bg-[#004c4c] text-white font-bold py-3 rounded-lg hover:bg-emerald-800 transition shadow-md flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                            Generate Printable Assignment
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- The Document for Printing (Hidden initially) -->
        <div id="print-view-container" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4">
            <div id="print-assignment" class="max-w-2xl w-full p-12 shadow-2xl overflow-y-auto max-h-screen">
                <div class="border-b-4 border-[#004c4c] pb-4 mb-8 flex justify-between items-end">
                    <div>
                        <h1 class="text-3xl font-bold text-[#004c4c]">Assignment Submission</h1>
                        <p class="text-gray-500">Story: Jose & Fatima (A Cultural Bridge)</p>
                    </div>
                    <div class="text-right">
                        <p id="print-date" class="text-sm font-bold"></p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-8 mb-10">
                    <div>
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest">Student Name</h3>
                        <p id="doc-name" class="text-xl font-bold text-gray-800 border-b border-dashed border-gray-300 pb-1"></p>
                    </div>
                    <div>
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest">Vocabulary Word</h3>
                        <p id="doc-word" class="text-xl font-bold text-emerald-700"></p>
                    </div>
                </div>

                <div class="mb-10">
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">Original Sentence</h3>
                    <div class="bg-gray-50 p-6 rounded-lg border italic text-lg leading-relaxed text-gray-700" id="doc-sentence"></div>
                </div>

                <div class="pt-8 border-t border-gray-100 flex justify-between items-center no-print">
                    <button onclick="window.print()" class="bg-emerald-600 text-white px-8 py-3 rounded-lg font-bold">Confirm & Print</button>
                    <button onclick="closePrint()" class="text-gray-400 hover:text-gray-600 font-medium">Cancel / Go Back</button>
                </div>
                
                <div class="hidden print:block mt-20">
                    <div class="flex justify-between">
                        <div class="border-t border-black w-48 text-center pt-2 text-xs">Teacher Signature</div>
                        <div class="border-t border-black w-48 text-center pt-2 text-xs">Date Reviewed</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        const storyPages = [
            { text: "Jose is from Mexico, and Fatima is from Morocco. They met at a university in Spain where they were both studying. Although they come from different countries and follow different traditions, they found they had much in common.", prompt: "Oil painting. A Mexican man and a Moroccan woman in a blue headscarf meeting in a sunlit library in Spain." },
            { text: "They began spending all their time together, studying in the library and sharing meals. Jose loved the smell of Fatima's Moroccan spices, and Fatima enjoyed learning about Jose's family in Mexico.", prompt: "Oil painting. A cozy cafe scene with Mexican tacos and Moroccan tagine on the table. Two students laughing." },
            { text: "To both of them, family is the most important thing. When they decided to get married, they knew they needed a meeting between their families to bridge their cultures.", prompt: "Oil painting. A home decorated with Moroccan lanterns and Mexican patterns. Hopeful atmosphere." },
            { text: "At first, the parents were nervous. But as they shared a meal, they soon realized their love for their children was exactly the same.", prompt: "Oil painting. Parents from different cultures shaking hands across a dinner table. Warm lighting." },
            { text: "Today, Jose and Fatima live happily, blending their two worlds into one. Love is the bridge that connects every culture.", prompt: "Oil painting. The couple walking in a garden with olive trees and colorful flowers. Peaceful." }
        ];

        const vocabulary = [
            { word: "Tradition", definition: "A custom or belief passed down through families." },
            { word: "Common", definition: "Shared by two or more people; alike." },
            { word: "Spices", definition: "Seeds or plants used to give food more flavor." },
            { word: "Important", definition: "Having great value or influence." },
            { word: "Bridge", definition: "Something that connects two different things." },
            { word: "Nervous", definition: "Feeling worried or afraid about something." },
            { word: "Silk", definition: "A fine, strong, soft, and shiny fabric." },
            { word: "Realize", definition: "To suddenly understand or become aware." },
            { word: "Blending", definition: "Mixing different things together smoothly." },
            { word: "Culture", definition: "The way of life and beliefs of a group of people." }
        ];

        let currentPage = 0;
        let quizTarget = null;

        function setView(view) {
            document.getElementById('story-view').classList.toggle('hidden', view !== 'story');
            document.getElementById('vocab-view').classList.toggle('hidden', view !== 'vocab');
            document.getElementById('tab-story').classList.toggle('active', view === 'story');
            document.getElementById('tab-vocab').classList.toggle('active', view === 'vocab');
            if (view === 'vocab') initVocab();
        }

        async function generateImage(prompt) {
            const loader = document.getElementById('loader');
            const imgEl = document.getElementById('story-image');
            imgEl.classList.add('hidden');
            loader.classList.remove('hidden');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ instances: [{ prompt }], parameters: { sampleCount: 1 } })
                });
                const result = await response.json();
                if (result.predictions?.[0]) {
                    imgEl.src = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                    imgEl.classList.remove('hidden');
                }
            } catch (e) { console.error(e); }
            loader.classList.add('hidden');
        }

        function updatePage() {
            document.getElementById('story-text').innerText = storyPages[currentPage].text;
            document.getElementById('page-number').innerText = `Page ${currentPage + 1} of ${storyPages.length}`;
            document.getElementById('progress-bar').style.width = `${((currentPage + 1) / storyPages.length) * 100}%`;
            document.getElementById('prev-btn').disabled = currentPage === 0;
            document.getElementById('next-btn').disabled = currentPage === storyPages.length - 1;
            generateImage(storyPages[currentPage].prompt);
        }

        function changePage(delta) { currentPage += delta; updatePage(); }

        async function readAloud() {
            const text = storyPages[currentPage].text;
            const msg = new SpeechSynthesisUtterance(text);
            msg.rate = 0.9;
            window.speechSynthesis.speak(msg);
        }

        function initVocab() {
            const container = document.getElementById('vocab-list');
            const select = document.getElementById('writing-word-select');
            if (container.children.length > 0) return;

            vocabulary.forEach(v => {
                const card = document.createElement('div');
                card.className = "bg-white border p-4 rounded-xl shadow-sm";
                card.innerHTML = `<h4 class="font-bold text-[#004c4c]">${v.word}</h4><p class="text-sm text-gray-600">${v.definition}</p>`;
                container.appendChild(card);
                const opt = document.createElement('option');
                opt.value = v.word; opt.innerText = v.word;
                select.appendChild(opt);
            });
            nextQuiz();
        }

        function nextQuiz() {
            quizTarget = vocabulary[Math.floor(Math.random() * vocabulary.length)];
            document.getElementById('quiz-definition').innerText = `"${quizTarget.definition}"`;
            const options = [...vocabulary].sort(() => 0.5 - Math.random()).slice(0, 4);
            if (!options.includes(quizTarget)) options[0] = quizTarget;
            const optContainer = document.getElementById('quiz-options');
            optContainer.innerHTML = '';
            options.sort(() => 0.5 - Math.random()).forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "bg-white border p-3 rounded-lg font-semibold hover:bg-orange-100 transition";
                btn.innerText = opt.word;
                btn.onclick = () => {
                    if (opt.word === quizTarget.word) {
                        btn.className = "bg-green-500 text-white p-3 rounded-lg font-semibold";
                        setTimeout(nextQuiz, 800);
                    } else {
                        btn.className = "bg-red-500 text-white p-3 rounded-lg font-semibold";
                        setTimeout(() => btn.className = "bg-white border p-3 rounded-lg font-semibold", 500);
                    }
                };
                optContainer.appendChild(btn);
            });
        }

        function generatePrintDoc() {
            const name = document.getElementById('student-name').value;
            const word = document.getElementById('writing-word-select').value;
            const sentence = document.getElementById('student-sentence').value;

            if (!name || !sentence.trim()) {
                alert("Please enter your name and write a sentence first!");
                return;
            }

            document.getElementById('doc-name').innerText = name;
            document.getElementById('doc-word').innerText = word;
            document.getElementById('doc-sentence').innerText = `"${sentence}"`;
            document.getElementById('print-date').innerText = new Date().toLocaleDateString();
            document.getElementById('print-view-container').classList.remove('hidden');
        }

        function closePrint() {
            document.getElementById('print-view-container').classList.add('hidden');
        }

        window.onload = updatePage;
    </script>
</body>
</html>
